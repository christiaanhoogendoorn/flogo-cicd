trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    # Check if Go is installed
    if ! command -v go &> /dev/null; then
        echo "Go is not installed. Installing Go..."
        sudo apt update
        sudo apt install -y golang-go
    fi

    # Install Flogo CLI
    go install github.com/project-flogo/cli/...@latest

    # Ensure the Flogo CLI is in the PATH
    export PATH=$PATH:$(go env GOPATH)/bin

    # Check the version to confirm installation
    flogo --version
  displayName: 'Install Flogo CLI'

- script: |
  # Ensure PATH is set again (each step is isolated in Azure DevOps)
  export PATH=$PATH:$(go env GOPATH)/bin

  # Run flogo build on your flogo.json
  flogo build -f flogo.json
displayName: 'Flogo Build'